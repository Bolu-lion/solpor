@page "/companies"
@using SolutionPortalBeta.Shared;
@inject HttpClient _httpClient
@inject NavigationManager _nav

<div class="admin-main">
    <Sidebar />
    <div class="company-container">
        <h1 class="title">Company List</h1>
        <div class="create-btn">
            <button @onclick="gotocreate">Create Company</button>
        </div>
        <div class="company-list">
            @foreach (var company in companies.OrderBy(company => company.id).Take(5))
            {
                <div class="company">
                    <h3>@company.Name</h3>
                    <div class="manage-comp">
                        <a class="mg-btn" href="createdepartment/@company.Name/@company.id">Add Department</a>
                        <a class="mg-btn" href="updatecompany/@company.id">Update Company</a>
                        <a class="mg-btn" href="deletecompany/@company.id">Delete Company</a>
                    </div>
                </div>
            }
            
        </div>
    </div>
</div>  
@code {
    List<CompanyModel> companies = new List<CompanyModel>();
    public void gotocreate()
    {
        _nav.NavigateTo("createcompany");
    }
    protected override async Task OnInitializedAsync()
    {
        var response = await _httpClient.GetAsync("api/Company/");
        companies = await response.Content.ReadFromJsonAsync<List<CompanyModel>>();
    }
}
